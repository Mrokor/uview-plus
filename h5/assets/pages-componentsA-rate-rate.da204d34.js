import{m as e,f as t,d as a,o as l,c as o,w as u,a as s,s as i,b as c,F as n,r as d,p as _,n as r,l as m,i as f,j as h,k as p}from"./index-32ebe9a0.js";import{_ as v}from"./u-icon.3d60c399.js";import{r as g}from"./uni-app.es.69356e58.js";import{_ as b}from"./_plugin-vue_export-helper.1b428a4d.js";const k=b({name:"u-rate",mixins:[e,t,{props:{modelValue:{type:[String,Number],default:()=>uni.$u.props.rate.value},count:{type:[String,Number],default:()=>uni.$u.props.rate.count},disabled:{type:Boolean,default:()=>uni.$u.props.rate.disabled},readonly:{type:Boolean,default:()=>uni.$u.props.rate.readonly},size:{type:[String,Number],default:()=>uni.$u.props.rate.size},inactiveColor:{type:String,default:()=>uni.$u.props.rate.inactiveColor},activeColor:{type:String,default:()=>uni.$u.props.rate.activeColor},gutter:{type:[String,Number],default:()=>uni.$u.props.rate.gutter},minCount:{type:[String,Number],default:()=>uni.$u.props.rate.minCount},allowHalf:{type:Boolean,default:()=>uni.$u.props.rate.allowHalf},activeIcon:{type:String,default:()=>uni.$u.props.rate.activeIcon},inactiveIcon:{type:String,default:()=>uni.$u.props.rate.inactiveIcon},touchable:{type:Boolean,default:()=>uni.$u.props.rate.touchable}}}],data(){return{elId:uni.$u.guid(),elClass:uni.$u.guid(),rateBoxLeft:0,activeIndex:this.modelValue,rateWidth:0,moving:!1}},watch:{modelValue(e){this.activeIndex=e},activeIndex:"emitEvent"},emits:["update:modelValue","change"],methods:{init(){uni.$u.sleep().then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await uni.$u.sleep(),this.$uGetRect("#"+this.elId).then((e=>{this.rateBoxLeft=e.left}))},getRateIconWrapRect(){this.$uGetRect("."+this.elClass).then((e=>{this.rateWidth=e.width}))},touchMove(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches[0].pageX;this.getActiveIndex(t)},touchEnd(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches[0].pageX;this.getActiveIndex(t)},clickHandler(e,t){if("ios"===uni.$u.os()&&this.moving)return;this.preventEvent(e);let a=0;a=e.changedTouches[0].pageX,this.getActiveIndex(a,!0)},emitEvent(){this.$emit("change",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(e,t=!1){if(this.disabled||this.readonly)return;const a=this.rateWidth*this.count+this.rateBoxLeft,l=e=uni.$u.range(this.rateBoxLeft,a,e)-this.rateBoxLeft;let o;if(this.allowHalf){o=Math.floor(l/this.rateWidth);const e=l%this.rateWidth;e<=this.rateWidth/2&&e>0?o+=.5:e>this.rateWidth/2&&o++}else{o=Math.floor(l/this.rateWidth);const e=l%this.rateWidth;t?e>0&&o++:e>this.rateWidth/2&&o++}this.activeIndex=Math.min(o,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}},mounted(){this.init()}},[["render",function(e,t,h,p,b,k){const I=g(a("u-icon"),v),y=f;return l(),o(y,{class:"u-rate",id:b.elId,ref:"u-rate",style:r([e.$u.addStyle(e.customStyle)])},{default:u((()=>[s(y,{class:"u-rate__content",onTouchmove:i(k.touchMove,["stop"]),onTouchend:i(k.touchEnd,["stop"])},{default:u((()=>[(l(!0),c(n,null,d(Number(e.count),((t,a)=>(l(),o(y,{class:_(["u-rate__content__item",[b.elClass]]),key:a},{default:u((()=>[s(y,{class:"u-rate__content__item__icon-wrap",ref_for:!0,ref:"u-rate__content__item__icon-wrap",onClick:i((e=>k.clickHandler(e,a+1)),["stop"])},{default:u((()=>[s(I,{name:Math.floor(b.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.floor(b.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{padding:`0 ${e.$u.addUnit(e.gutter/2)}`},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick"]),e.allowHalf?(l(),o(y,{key:0,onClick:i((e=>k.clickHandler(e,a+1)),["stop"]),class:"u-rate__content__item__icon-wrap u-rate__content__item__icon-wrap--half",style:r([{width:e.$u.addUnit(b.rateWidth/2)}]),ref_for:!0,ref:"u-rate__content__item__icon-wrap"},{default:u((()=>[s(I,{name:Math.ceil(b.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.ceil(b.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{padding:`0 ${e.$u.addUnit(e.gutter/2)}`},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick","style"])):m("",!0)])),_:2},1032,["class"])))),128))])),_:1},8,["onTouchmove","onTouchend"])])),_:1},8,["id","style"])}],["__scopeId","data-v-6938667e"]]);const I=b({data:()=>({value:3,value1:2,activeColorValue:3,HalfValue:3.5,activeIconValue:3}),watch:{value(e,t){}},methods:{change(e){}}},[["render",function(e,t,i,c,n,d){const _=p,r=g(a("up-rate"),k),m=f;return l(),o(m,{class:"u-page"},{default:u((()=>[s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("基本案例")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__tag-item"},{default:u((()=>[s(r,{size:"20"})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("自定义选中星星数量")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__tag-item flex"},{default:u((()=>[s(r,{size:"20",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onChange:d.change},null,8,["modelValue","onChange"])])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("自定义星星大小")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__tag-item"},{default:u((()=>[s(r,{size:"30",count:"4"})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("是否禁用评分")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",disabled:""})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("是否只读评分")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",readonly:""})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("自定义选中星星颜色")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",modelValue:n.activeColorValue,"onUpdate:modelValue":t[1]||(t[1]=e=>n.activeColorValue=e),activeColor:"#2979ff"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("自定义未选中星星颜色")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",modelValue:n.value1,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value1=e),inactiveColor:"#2979ff"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("禁止触摸选择")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",touchable:!1})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("允许触摸选择")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",touchable:!0})])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("是否允许半星")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",modelValue:n.HalfValue,"onUpdate:modelValue":t[3]||(t[3]=e=>n.HalfValue=e),allowHalf:!0,onChange:d.change},null,8,["modelValue","onChange"])])),_:1})])),_:1})])),_:1}),s(m,{class:"u-demo-block"},{default:u((()=>[s(_,{class:"u-demo-block__title"},{default:u((()=>[h("自定义选中的图标")])),_:1}),s(m,{class:"u-demo-block__content"},{default:u((()=>[s(m,{class:"u-page__rate-item"},{default:u((()=>[s(r,{size:"20",modelValue:n.activeIconValue,"onUpdate:modelValue":t[4]||(t[4]=e=>n.activeIconValue=e),inactiveIcon:"heart",activeIcon:"heart-fill"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-7031a09d"]]);export{I as default};
