import{d as e,o as t,c as a,w as l,a as o,p as u,b as s,F as i,r as c,l as n,n as d,f as r,i as _,g as m,h as f}from"./index-aa2b8fb8.js";import{_ as h}from"./u-icon.9dfb5cac.js";import{r as p}from"./uni-app.es.392722c2.js";import{m as v,a as g}from"./mixin.d0c91ebc.js";import{_ as b}from"./_plugin-vue_export-helper.1b428a4d.js";const k=b({name:"u-rate",mixins:[v,g,{props:{modelValue:{type:[String,Number],default:()=>uni.$u.props.rate.value},count:{type:[String,Number],default:()=>uni.$u.props.rate.count},disabled:{type:Boolean,default:()=>uni.$u.props.rate.disabled},readonly:{type:Boolean,default:()=>uni.$u.props.rate.readonly},size:{type:[String,Number],default:()=>uni.$u.props.rate.size},inactiveColor:{type:String,default:()=>uni.$u.props.rate.inactiveColor},activeColor:{type:String,default:()=>uni.$u.props.rate.activeColor},gutter:{type:[String,Number],default:()=>uni.$u.props.rate.gutter},minCount:{type:[String,Number],default:()=>uni.$u.props.rate.minCount},allowHalf:{type:Boolean,default:()=>uni.$u.props.rate.allowHalf},activeIcon:{type:String,default:()=>uni.$u.props.rate.activeIcon},inactiveIcon:{type:String,default:()=>uni.$u.props.rate.inactiveIcon},touchable:{type:Boolean,default:()=>uni.$u.props.rate.touchable}}}],data(){return{elId:uni.$u.guid(),elClass:uni.$u.guid(),rateBoxLeft:0,activeIndex:this.modelValue,rateWidth:0,moving:!1}},watch:{modelValue(e){this.activeIndex=e},activeIndex:"emitEvent"},emits:["update:modelValue","change"],methods:{init(){uni.$u.sleep().then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await uni.$u.sleep(),this.$uGetRect("#"+this.elId).then((e=>{this.rateBoxLeft=e.left}))},getRateIconWrapRect(){this.$uGetRect("."+this.elClass).then((e=>{this.rateWidth=e.width}))},touchMove(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches[0].pageX;this.getActiveIndex(t)},touchEnd(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches[0].pageX;this.getActiveIndex(t)},clickHandler(e,t){if("ios"===uni.$u.os()&&this.moving)return;this.preventEvent(e);let a=0;a=e.changedTouches[0].pageX,this.getActiveIndex(a,!0)},emitEvent(){this.$emit("change",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(e,t=!1){if(this.disabled||this.readonly)return;const a=this.rateWidth*this.count+this.rateBoxLeft,l=e=uni.$u.range(this.rateBoxLeft,a,e)-this.rateBoxLeft;let o;if(this.allowHalf){o=Math.floor(l/this.rateWidth);const e=l%this.rateWidth;e<=this.rateWidth/2&&e>0?o+=.5:e>this.rateWidth/2&&o++}else{o=Math.floor(l/this.rateWidth);const e=l%this.rateWidth;t?e>0&&o++:e>this.rateWidth/2&&o++}this.activeIndex=Math.min(o,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}},mounted(){this.init()}},[["render",function(m,f,v,g,b,k){const I=p(e("u-icon"),h),y=_;return t(),a(y,{class:"u-rate",id:b.elId,ref:"u-rate",style:d([m.$u.addStyle(m.customStyle)])},{default:l((()=>[o(y,{class:"u-rate__content",onTouchmove:u(k.touchMove,["stop"]),onTouchend:u(k.touchEnd,["stop"])},{default:l((()=>[(t(!0),s(i,null,c(Number(m.count),((e,s)=>(t(),a(y,{class:n(["u-rate__content__item",[b.elClass]]),key:s},{default:l((()=>[o(y,{class:"u-rate__content__item__icon-wrap",ref_for:!0,ref:"u-rate__content__item__icon-wrap",onClick:u((e=>k.clickHandler(e,s+1)),["stop"])},{default:l((()=>[o(I,{name:Math.floor(b.activeIndex)>s?m.activeIcon:m.inactiveIcon,color:m.disabled?"#c8c9cc":Math.floor(b.activeIndex)>s?m.activeColor:m.inactiveColor,"custom-style":{padding:`0 ${m.$u.addUnit(m.gutter/2)}`},size:m.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick"]),m.allowHalf?(t(),a(y,{key:0,onClick:u((e=>k.clickHandler(e,s+1)),["stop"]),class:"u-rate__content__item__icon-wrap u-rate__content__item__icon-wrap--half",style:d([{width:m.$u.addUnit(b.rateWidth/2)}]),ref_for:!0,ref:"u-rate__content__item__icon-wrap"},{default:l((()=>[o(I,{name:Math.ceil(b.activeIndex)>s?m.activeIcon:m.inactiveIcon,color:m.disabled?"#c8c9cc":Math.ceil(b.activeIndex)>s?m.activeColor:m.inactiveColor,"custom-style":{padding:`0 ${m.$u.addUnit(m.gutter/2)}`},size:m.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick","style"])):r("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1},8,["onTouchmove","onTouchend"])])),_:1},8,["id","style"])}],["__scopeId","data-v-6938667e"]]);const I=b({data:()=>({value:3,value1:2,activeColorValue:3,HalfValue:3.5,activeIconValue:3}),watch:{value(e,t){}},methods:{change(e){}}},[["render",function(u,s,i,c,n,d){const r=f,h=p(e("u-rate"),k),v=_;return t(),a(v,{class:"u-page"},{default:l((()=>[o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("基本案例")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__tag-item"},{default:l((()=>[o(h,{size:"20"})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("自定义选中星星数量")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__tag-item flex"},{default:l((()=>[o(h,{size:"20",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),onChange:d.change},null,8,["modelValue","onChange"])])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("自定义星星大小")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__tag-item"},{default:l((()=>[o(h,{size:"30",count:"4"})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("是否禁用评分")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",disabled:""})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("是否只读评分")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",readonly:""})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("自定义选中星星颜色")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",modelValue:n.activeColorValue,"onUpdate:modelValue":s[1]||(s[1]=e=>n.activeColorValue=e),activeColor:"#2979ff"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("自定义未选中星星颜色")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",modelValue:n.value1,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value1=e),inactiveColor:"#2979ff"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("禁止触摸选择")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",touchable:!1})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("允许触摸选择")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",touchable:!0})])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("是否允许半星")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",modelValue:n.HalfValue,"onUpdate:modelValue":s[3]||(s[3]=e=>n.HalfValue=e),allowHalf:!0,onChange:d.change},null,8,["modelValue","onChange"])])),_:1})])),_:1})])),_:1}),o(v,{class:"u-demo-block"},{default:l((()=>[o(r,{class:"u-demo-block__title"},{default:l((()=>[m("自定义选中的图标")])),_:1}),o(v,{class:"u-demo-block__content"},{default:l((()=>[o(v,{class:"u-page__rate-item"},{default:l((()=>[o(h,{size:"20",modelValue:n.activeIconValue,"onUpdate:modelValue":s[4]||(s[4]=e=>n.activeIconValue=e),inactiveIcon:"heart",activeIcon:"heart-fill"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-4323bf87"]]);export{I as default};
