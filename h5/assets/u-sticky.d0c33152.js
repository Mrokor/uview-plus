import{o as t,c as i,w as s,a as e,n as o,k as n,i as c}from"./index-aa2b8fb8.js";import{m as u,a as r}from"./mixin.d0c91ebc.js";import{_ as d}from"./_plugin-vue_export-helper.1b428a4d.js";const h=d({name:"u-sticky",mixins:[u,r,{props:{offsetTop:{type:[String,Number],default:()=>uni.$u.props.sticky.offsetTop},customNavHeight:{type:[String,Number],default:44},disabled:{type:Boolean,default:()=>uni.$u.props.sticky.disabled},bgColor:{type:String,default:()=>uni.$u.props.sticky.bgColor},zIndex:{type:[String,Number],default:()=>uni.$u.props.sticky.zIndex},index:{type:[String,Number],default:()=>uni.$u.props.sticky.index}}}],data:()=>({cssSticky:!1,stickyTop:0,elId:uni.$u.guid(),left:0,width:"auto",height:"auto",fixed:!1}),computed:{style(){const t={};return this.disabled?t.position="static":this.cssSticky?(t.position="sticky",t.zIndex=this.uZindex,t.top=uni.$u.addUnit(this.stickyTop)):t.height=this.fixed?this.height+"px":"auto",t.backgroundColor=this.bgColor,uni.$u.deepMerge(uni.$u.addStyle(this.customStyle),t)},stickyContent(){const t={};return this.cssSticky||(t.position=this.fixed?"fixed":"static",t.top=this.stickyTop+"px",t.left=this.left+"px",t.width="auto"==this.width?"auto":this.width+"px",t.zIndex=this.uZindex),t},uZindex(){return this.zIndex?this.zIndex:uni.$u.zIndex.sticky}},mounted(){this.init()},methods:{init(){this.getStickyTop(),this.checkSupportCssSticky(),this.cssSticky||!this.disabled&&this.initObserveContent()},initObserveContent(){this.$uGetRect("#"+this.elId).then((t=>{this.height=t.height,this.left=t.left,this.width=t.width,this.$nextTick((()=>{this.observeContent()}))}))},observeContent(){this.disconnectObserver("contentObserver");const t=uni.createIntersectionObserver({thresholds:[.95,.98,1]});t.relativeToViewport({top:-this.stickyTop}),t.observe(`#${this.elId}`,(t=>{this.setFixed(t.boundingClientRect.top)})),this.contentObserver=t},setFixed(t){const i=t<=this.stickyTop;this.fixed=i},disconnectObserver(t){const i=this[t];i&&i.disconnect()},getStickyTop(){this.stickyTop=uni.$u.getPx(this.offsetTop)+uni.$u.getPx(this.customNavHeight)},async checkSupportCssSticky(){this.checkCssStickyForH5()&&(this.cssSticky=!0),"android"===uni.$u.os()&&Number(uni.$u.sys().system)>8&&(this.cssSticky=!0),"ios"===uni.$u.os()&&(this.cssSticky=!0)},checkComputedStyle(){},checkCssStickyForH5(){const t=["","-webkit-","-ms-","-moz-","-o-"],i=t.length,s=document.createElement("div");for(let e=0;e<i;e++)if(s.style.position=t[e]+"sticky",""!==s.style.position)return!0;return!1}},beforeUnmount(){this.disconnectObserver("contentObserver")}},[["render",function(u,r,d,h,p,y){const a=c;return t(),i(a,{class:"u-sticky",id:p.elId,style:o([y.style])},{default:s((()=>[e(a,{style:o([y.stickyContent]),class:"u-sticky__content"},{default:s((()=>[n(u.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3},8,["id","style"])}],["__scopeId","data-v-5c210652"]]);export{h as _};
